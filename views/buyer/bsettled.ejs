<% layout("/layouts/boilerplate") %>

<div class="container mt-4">
  <!-- PAGE HEADER -->
  <div class="card shadow-sm mb-4">
    <div class="card-body bg-success-subtle rounded text-center">
      <h4 class="mb-1 text-success fw-bold">
        <i class="fa-solid fa-circle-check me-2"></i> Settled Crop Payments
      </h4>
      <p class="text-muted mb-0">
        Buyers whose crop payments are fully settled
      </p>
    </div>
  </div>

  <!-- SEARCH BAR -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <form method="GET" action="/buyer/settled">
        <div class="input-group">
          <span
            class="input-group-text bg-success-subtle border-0 text-success"
          >
            <i class="fa-solid fa-magnifying-glass"></i>
          </span>

          <input
            type="text"
            name="search"
            value="<%= search || '' %>"
            class="form-control"
            placeholder="Search by Buyer ID or Name"
          />

          <button class="btn btn-success px-4">Search</button>
        </div>
      </form>
    </div>
  </div>

  <!-- EMPTY STATE -->
  <% if (buyers.length === 0) { %>

  <div class="alert alert-success text-center shadow-sm">
    <i class="fa-solid fa-circle-check me-1"></i>
    <strong>No settled buyers found</strong>
  </div>

  <% } else { %>

  <!-- TABLE -->
  <div class="card shadow-sm">
    <div class="card-header bg-success text-white fw-semibold rounded-top">
      <i class="fa-solid fa-list-check me-1"></i> Settled Buyers List
    </div>

    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-success">
          <tr>
            <th>Buyer ID</th>
            <th>Name</th>
            <th>Mobile</th>
            <th>Address</th>
            <th class="text-center">Action</th>
          </tr>
        </thead>

        <tbody>
          <% buyers.forEach(buyer => { %>
          <tr>
            <td>
              <span class="badge bg-success rounded-pill px-3 py-2 fs-6">
                <%= buyer.buyerId %>
              </span>
            </td>

            <td><%= buyer.name %></td>

            <td>
              <i class="fa-solid fa-phone text-success me-1"></i>
              <%= buyer.mobile %>
            </td>

            <td class="text-muted">
              <i class="fa-solid fa-location-dot me-1"></i>
              <%= buyer.address %>, <%= buyer.city %>, <%= buyer.state %>
            </td>

            <td class="text-center">
              <a
                href="/buyer/<%= buyer.buyerId %>/detail"
                class="btn btn-sm btn-success px-3"
              >
                Details
              </a>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>

  <% } %>
</div>
